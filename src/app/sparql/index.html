<!DOCTYPE html>
<html>
<head>
  <title>ORR SPARQL UI</title>
  <link href="https://unpkg.com/@triply/yasgui/build/yasgui.min.css" rel="stylesheet" type="text/css" />
  <script src="https://unpkg.com/@triply/yasgui/build/yasgui.min.js"></script>
  <style>
    .endpointText {
      display: none !important;
    }
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
  </style>
  <link rel='stylesheet' href='css/orrportal.css'>
  <script src='js/config.js'></script>
  <script src='js/local.config.js'></script>
</head>

<body>

<div style="width: 100%; margin-bottom: 20px">
  <div class="effect1">
    <div style="padding: 4px">
      <span title="Go to main page">
        <a id="mainPage" href="" title="Go to main page">
          <img id="logoImg" src="" style="vertical-align: middle"></a>
      </span>
    </div>
  </div>
</div>

<div style="margin: 5px; font-family: Arial, sans-serif">
  Edit, submit, and view the results of <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/SPARQL">SPARQL</a>
  queries against the repository.
  <br>
  SPARQL examples are included in the
  <a target="_blank" rel="noopener" href="https://mmisw.org/orrdoc/query/#some-sparql-examples"
  >query section</a> of the documentation.
  <span style="color:gray;font-size:small">
    <br>
    (The SPARQL endpoint itself is located at
    <span id="sparql" style="font-family: monospace"></span>.
    User interface below powered by <a target="_blank" rel="noopener" href="https://github.com/TriplyDB/YASGUI" style="color:gray">YASGUI</a>.)
  </span>
</div>

<div id="editor"></div>

<script>
  var debug = window.location.search.match(/.*debug.*/)

  // (1) looks like not all of the "default" mechanism is having effect anymore:
  Yasgui.Yasqe.defaults.requestConfig.endpoint = appConfig.orront.sparqlEndpoint;
  Yasgui.Yasqe.defaults.requestConfig.headers = "application/rdf+xml";
  Yasgui.defaults.catalogueEndpoints = [];

  //(2) so, pass an explicit config object to the constructor:
  var config = {
    yasqe: {
      sparql: {
        endpoint: appConfig.orront.sparqlEndpoint,
        acceptHeaderGraph: "application/rdf+xml"
      }
    },
    catalogueEndpoints: []
  };
  var yasgui = new Yasgui(document.getElementById("editor"), config);
  // Add a new Tab. Returns the new Tab object.
  var query1 = yasgui.addTab(
    true, // set as active tab
    { ...Yasgui.Tab.getDefaults(), name: "Example Query 1" }
  );
  // Get a Tab. Returns the current Tab if no tab id is given.
  query1.setQuery("SELECT * WHERE {\n\t?sub ?pred ?obj .\n} LIMIT 10");

  // Add a new Tab. Returns the new Tab object.
  var query2 = yasgui.addTab(
    { ...Yasgui.Tab.getDefaults(), name: "Example Query 2" }
  );
  // Get a Tab. Returns the current Tab if no tab id is given.
  query2.setQuery("PREFIX geo: <http://www.opengis.net/ont/geosparql#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX vocab: <http://cor.esipfed.org/ont/geotriples/GRanD_dams_v1_1/>\nSELECT ?wkt ?wktLabel WHERE {\n\t?geometry a geo:Geometry .\n\t?geometry a owl:NamedIndividual .\n\t?geometry geo:asWKT ?wkt .\n\t?dam geo:hasGeometry ?geometry .\n\t?dam vocab:has_DAM_NAME ?wktLabel .\n} LIMIT 100");

  //var yasgui = YASGUI(document.getElementById("editor"), config);
  if (debug) {
    console.log('config=', config, 'yasgui=', yasgui);
  }

  document.getElementById("mainPage").href    = appConfig.portal.mainPage;
  document.getElementById("logoImg").src      = appConfig.branding.logo;
  document.getElementById("sparql").innerHTML = appConfig.orront.sparqlEndpoint;
</script>

<noscript>
  <div class="noscript">
    The ORR application requires Javascript to be enabled in your browser.
  </div>
</noscript>
</body>
</html>
